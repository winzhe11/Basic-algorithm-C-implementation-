### 1.2.1 高精度计算

*2024年4月16日*

**高精度加法**

```c++
#include <iostream>
#include <vector>

using namespace std;

vector <int> add(vector <int> &a, vector <int> &b) {//用&直接传地址运行更快
    vector <int> c;
    int t = 0;// t为进为，开始进位为0
    for (int i = 0; i < a.size() || i < b.size(); i++) {
        //此处判断条件必须写两个， 防止一个数字加完后就结束循环
        if (i < a.size()) t += a[i];
        if (i < b.size()) t += b[i];
        c.push_back(t % 10);
        t /= 10;
    }
    // 循环结束后，可能还会进一位
    if (t) c.push_back(1);
    return c;
}
int main() {
    string a, b; // 将数字储存在字符串里，方便颠倒顺序
    vector <int> A, B;
    cin >> a >> b;
    // 为了方便计算，将数字个位存入数组个位
    for (int i = a.size() - 1; i >= 0; i--) A.push_back(a[i] - '0');
    for (int i = b.size() - 1; i >= 0; i--) B.push_back(b[i] - '0');
    auto c = add(A, B);
    //逆序输出，符合常理
    for (int i = c.size() - 1; i >= 0; i--) cout << c[i];
    return 0;
}

```

其中t最后一次进位也可以这么写：

```c++
直接将t是否存在也纳入判断条件
for (int i = 0; i < a.size() || i < b.size() || t; i++) {
        if (i < a.size()) t += a[i];
        if (i < b.size()) t += b[i];
        c.push_back(t % 10);
        t /= 10;
    }
```

**高精度减法**

```c++
#include <iostream>
#include <vector>

using namespace std;
// 比较A和B的大小
bool cmp(vector <int> &a, vector <int> &b) {
    if (a.size() != b.size()) return a.size() > b.size();
    for (int i = a.size() - 1; i >= 0; i--)
        if (a[i] != b[i])
            return a[i] > b[i];
    return true;
}
vector <int> sub(vector <int> &a, vector <int> &b) {
    vector <int> c;
    for (int i = 0, t = 0; i < a.size(); i++) { // 此处A的长度绝对大于B 所以一个条件即可
        t = a[i] - t;
        if (i < b.size()) t -= b[i]; // t 为借位， t为0时，代码等效于a - b, t != 0时，等效于减去借位再做差
        c.push_back((t + 10) % 10);
        //检查是否借位了
        if (t >= 0) t = 0;
        else t = 1;
    }
    // 去除例如 1000 - 999 = 001 的前奏0
    while (c.size() > 1 && c.back() == 0) c.pop_back();
    return c;
}
int main() {
    string a, b;
    vector <int> A, B;
    cin >> a >> b;
    for (int i = a.size() - 1; i >= 0; i--) A.push_back(a[i] - '0');
    for (int i = b.size() - 1; i >= 0; i--) B.push_back(b[i] - '0');
    // 分支讨论结果为正和负
    if (cmp(A, B)) {
        auto c = sub(A, B);
        for (int i = c.size() - 1; i >= 0; i--) cout << c[i];
    }
    else {
        auto c = sub(B, A);
        cout << '-';
        for (int i = c.size() - 1; i >= 0; i--) cout << c[i];
    }
    return 0;
}

```

**高精度数乘常数（int）**

```c++
#include <iostream>
#include <vector>

using namespace std;

vector <int> mul(vector <int> &a, int n) {
    vector <int> c;
    for (int i = 0, t = 0; i < a.size() || t; i++) {
        if (i < a.size()) t = t + a[i] * n;
        c.push_back(t % 10);
        t /= 10;
    }
    return c;
}
int main() {
    string a;
    int n;
    vector <int> A;
    cin >> a >> n;
    for (int i = a.size() - 1; i >= 0; i--) A.push_back(a[i] - '0');
    auto c = mul(A, n);
    for (int i = c.size() - 1; i >= 0; i--) cout << c[i];
    return 0;
}
```

**高精度数除以常数（int）**

```c++
#include <iostream>
#include <vector>
#include <algorithm>

using namespace std;

vector <int> div(vector <int> &a, int n, int &r) {
    vector <int> c;
    r = 0; // r为余数
    for (int i = a.size() - 1; i >= 0; i--) {
        r = r * 10 + a[i];
        c.push_back(r / n);
        r %= n;
    }
    reverse(c.begin(), c.end());
    while (c.size() > 1 && c.back() == 0) c.pop_back();
    return c;
}
int main() {
    string a;
    vector <int> A;
    int n, r;
    cin >> a >> n;
    for (int i = a.size() - 1; i >= 0; i--) A.push_back(a[i] - '0');
    auto c = div(A, n, r);
    for (int i = c.size() - 1; i >= 0; i--) cout << c[i];
    cout <<  ' ' << r;
    return 0;
}
```

### 变式题

#### P1009 [NOIP 1998 普及组] 阶乘之和

**题目描述**

用高精度计算出 $S = 1! + 2! + 3! + \cdots + n!$（$n \le 50$）。

其中 `!` 表示阶乘，定义为 $n!=n\times (n-1)\times (n-2)\times \cdots \times 1$。例如，$5! = 5 \times 4 \times 3 \times 2 \times 1=120$。

**输入格式**

一个正整数 $n$。

**输出格式**

一个正整数 $S$，表示计算结果。

**输入输出样例 #1**

**输入 #1**

```
3
```

**输出 #1**

```
9
```

**说明/提示**

**【数据范围】**

对于 $100 \%$ 的数据，$1 \le n \le 50$。

**【其他说明】**

注，《深入浅出基础篇》中使用本题作为例题，但是其数据范围只有 $n \le 20$，使用书中的代码无法通过本题。

如果希望通过本题，请继续学习第八章高精度的知识。

NOIP1998 普及组 第二题

```c++
```

